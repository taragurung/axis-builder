!function(a){"use strict";a.AxisBuilderModal=function(b){var c={modal_title:"",modal_class:"",modal_content:!1,modal_ajax_hook:"",button:"save",ajax_param:"",save_param:{},scope:this,on_save:function(){},on_load:function(){},before_save:""};a.AxisBuilderModal.openInstance.unshift(this),this.doc=a(document),this.wrap=a("#wpwrap"),this.body=a("body").addClass("axisbuilder-noscroll"),this.options=a.extend({},c,b),this.modal=a('<div class="axisbuilder-modal axisbuilder-style popup-animation"></div>'),this.backdrop=a('<div class="axisbuilder-modal-backdrop"></div>'),this.instanceNr=a.AxisBuilderModal.openInstance.length,this.namespace=".AxisBuilderModal"+this.instanceNr,this.modalSetup()},a.AxisBuilderModal.openInstance=[],a.AxisBuilderModal.prototype={modalSetup:function(){this.appendHTML(),this.modalBehaviour(),this.modifyBindingOrder(),this.propogateModalopen()},appendHTML:function(){var a,b=this.options.modal_content?this.options.modal_content:"",c=this.options.modal_content?"":"loader ",d='<h3 class="axisbuilder-modal-title">'+this.options.modal_title+"</h3>";a='<div class="axisbuilder-modal-inner">',a+='<div class="axisbuilder-modal-inner-header">'+d+'<a href="#close" class="axisbuilder-modal-close trash-modal-icon axisbuilder-attach-close-event"></a></div>',a+='<div class="axisbuilder-modal-inner-content '+c+'">'+b+"</div>",a+='<div class="axisbuilder-modal-inner-footer">',a+="save"===this.options.button?'<a href="#save" class="axisbuilder-save-modal button button-primary button-large">'+axisbuilder_modal.save+"</a>":"close"===this.options.button?'<a href="#close" class="axisbuilder-attach-close-event button button-primary button-large">'+axisbuilder_modal.close+"</a>":this.options.button,a+="</div>",a+="</div>",this.options.modal_class&&this.modal.addClass(this.options.modal_class),this.wrap.append(this.modal).append(this.backdrop),this.modal.html(a);var e=this.instanceNr-1,f=parseInt(this.modal.css("zIndex"),10);this.modal.css({margin:30*e,zIndex:f+e+1}),this.backdrop.css({zIndex:f+e}),this.options.modal_content?this.loadCallback():this.fetchContent()},fetchContent:function(){var b=this,c=b.modal.find(".axisbuilder-modal-inner-content"),d={fetch:!0,params:this.options.ajax_param,action:"axisbuilder_"+this.options.modal_action,instance:this.instanceNr};a.ajax({url:axisbuilder_admin.ajax_url,data:d,type:"POST",error:function(){a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.ajax_error})},success:function(d){"0"===d?(a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.login_error})):"-1"===d?(a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.timeout})):(c.html(d),b.loadCallback())},complete:function(){c.removeClass("loader")}})},loadCallback:function(){},modalBehaviour:function(){var a=this;this.modal.on("click",".axisbuilder-save-modal",function(){return!1}),this.backdrop.add(".axisbuilder-attach-close-event",this.modal).on("click",function(){return a.close(),!1}),this.doc.bind("keydown"+this.namespace,function(b){a.linkOverlayClosed&&a.mediaOverlayClosed&&(13!==b.keyCode||b.target.tagName&&"textarea"===b.target.tagName.toLowerCase()||(setTimeout(function(){},100),b.stopImmediatePropagation()),27===b.keyCode&&(setTimeout(function(){a.close()},100),b.stopImmediatePropagation()))})},modifyBindingOrder:function(){var a=jQuery.hasData(document)&&jQuery._data(document),b=a.events.keydown.pop();a.events.keydown.unshift(b)},close:function(){a.AxisBuilderModal.openInstance.shift(),this.doc.trigger("axisbuilder_modal_before_close",[this]),this.modal.remove(),this.backdrop.remove(),this.doc.trigger("axisbuilder_modal_close",[this]).unbind("keydown"+this.namespace),0===a.AxisBuilderModal.openInstance.length&&this.body.removeClass("axisbuilder-noscroll")},linkOverlayClosed:function(){var b=a("#wp-link-wrap:visible");return b.length?!1:!0},mediaOverlayClosed:function(){return!0},propogateModalopen:function(){this.body.trigger("axisbuilder_modal_open",this)},propogateModalContent:function(){this.body.trigger("axisbuilder_modal_open",this)}},a.AxisBuilderModalNotification=function(b){var c={button:"close",modal_class:"flexscreen",modal_title:'<span class="axisbuilder-message-'+b.mode+'">'+axisbuilder_modal[b.mode]+"</span>",modal_content:'<div class="axisbuilder-form-element-container">'+b.message+"</div>"};return this.options=a.extend({},c,b),new a.AxisBuilderModal(this.options)}}(jQuery);