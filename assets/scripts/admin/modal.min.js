!function(a){"use strict";a.AxisBuilderModal=function(b){var c={modal_title:"",modal_class:"",modal_content:!1,modal_action:"",button:"save",ajax_param:"",save_param:{},scope:this,on_save:function(){},on_load:function(){},before_save:""};a.AxisBuilderModal.openInstance.unshift(this),this.doc=a(document),this.wrap=a("#wpwrap"),this.body=a("body").addClass("axisbuilder-noscroll"),this.options=a.extend({},c,b),this.modal=a('<div class="axisbuilder-modal axisbuilder-style popup-animation"></div>'),this.backdrop=a('<div class="axisbuilder-modal-backdrop"></div>'),this.instanceNr=a.AxisBuilderModal.openInstance.length,this.namespace=".AxisBuilderModal"+this.instanceNr,this.modalSetup()},a.AxisBuilderModal.openInstance=[],a.AxisBuilderModal.prototype={modalSetup:function(){this.appendHTML(),this.modalBehaviour(),this.modifyBindingOrder(),this.propogateModalopen()},appendHTML:function(){var a,b=this.options.modal_content?this.options.modal_content:"",c=this.options.modal_content?"":"loader ",d='<h3 class="axisbuilder-modal-title">'+this.options.modal_title+"</h3>";a='<div class="axisbuilder-modal-inner">',a+='<div class="axisbuilder-modal-inner-header">'+d+'<a href="#close" class="axisbuilder-modal-close trash-modal-icon axisbuilder-attach-close-event"></a></div>',a+='<div class="axisbuilder-modal-inner-content '+c+'">'+b+"</div>",a+='<div class="axisbuilder-modal-inner-footer">',a+="save"===this.options.button?'<a href="#save" class="axisbuilder-save-modal button button-primary button-large">'+axisbuilder_modal.i18n_save_button+"</a>":"close"===this.options.button?'<a href="#close" class="axisbuilder-attach-close-event button button-primary button-large">'+axisbuilder_modal.i18n_close_button+"</a>":this.options.button,a+="</div>",a+="</div>",this.options.modal_class&&this.modal.addClass(this.options.modal_class),this.wrap.append(this.modal).append(this.backdrop),this.modal.html(a);var e=this.instanceNr-1,f=parseInt(this.modal.css("zIndex"),10);this.modal.css({margin:30*e,zIndex:f+e+1}),this.backdrop.css({zIndex:f+e}),this.options.modal_content?this.loadCallback():this.fetchContent()},fetchContent:function(){var b=this,c=b.modal.find(".axisbuilder-modal-inner-content"),d={fetch:!0,params:this.options.ajax_param,action:"axisbuilder_"+this.options.modal_action,security:axisbuilder_modal.get_modal_elements_nonce,instance:this.instanceNr};a.ajax({url:axisbuilder_modal.ajax_url,data:d,type:"POST",error:function(){a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.i18n_ajax_error})},success:function(d){"0"===d?(a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.i18n_login_error})):"-1"===d?(a.AxisBuilderModal.openInstance[0].close(),a.AxisBuilderModalNotification({mode:"error",message:axisbuilder_modal.i18n_session_error})):(c.html(d),b.loadCallback())},complete:function(){c.removeClass("loader")}})},loadCallback:function(){var b,c=this.options.on_load,d=0;if("string"==typeof c){b=c.split(", ");for(d in b)"undefined"!==a.AxisBuilderModal.registerCallback[b[d]]?a.AxisBuilderModal.registerCallback[b[d]].call(this):(new AB_Logger("Not defined modal_on_load function: $.AxisBuilderModal.register_callback."+b[d],"error"),new AB_Logger("Ensure that the modal_on_load function is defined in your Shortcodes Configurations.","help"))}else"function"==typeof c&&c.call();this.setFocus(),this.propogateModalContent()},setFocus:function(){var a=this.modal.find("input[type=text], input[type=checkpox], textarea, select, radio").filter(":eq(0)");a.is(".axisbuilder-autoselect-off")||a.focus()},modalBehaviour:function(){var a=this;this.modal.on("click",".axisbuilder-save-modal",function(){return a.executeCallback(),!1}),this.backdrop.add(".axisbuilder-attach-close-event",this.modal).on("click",function(){return a.close(),!1}),this.doc.bind("keydown"+this.namespace,function(b){a.linkOverlayClosed&&a.mediaOverlayClosed&&(b=b||window.event,13!==b.which||b.target.tagName&&"textarea"===b.target.tagName.toLowerCase()||(setTimeout(function(){a.executeCallback()},100),b.stopImmediatePropagation()),27===b.which&&(setTimeout(function(){a.close()},100),b.stopImmediatePropagation()))})},executeCallback:function(){var b=this.modal.find("input, textarea, select, radio").serializeArray(),c=this.convertValues(b);"undefined"!=typeof a.AxisBuilderModal.registerCallback[this.options.before_save]&&(c=a.AxisBuilderModal.registerCallback[this.options.before_save].call(this.options.scope,c,this.options.save_param));var d=this.options.on_save.call(this.options.scope,c,this.options.save_param);d!==!1&&this.close()},convertValues:function(b){var c={};return a.each(b,function(){"undefined"!=typeof c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},modifyBindingOrder:function(){var a=jQuery.hasData(document)&&jQuery._data(document),b=a.events.keydown.pop();a.events.keydown.unshift(b)},close:function(){a.AxisBuilderModal.openInstance.shift(),this.doc.trigger("axisbuilder_modal_before_close",[this]),this.modal.remove(),this.backdrop.remove(),this.doc.trigger("axisbuilder_modal_close",[this]).unbind("keydown"+this.namespace),0===a.AxisBuilderModal.openInstance.length&&this.body.removeClass("axisbuilder-noscroll")},linkOverlayClosed:function(){var b=a("#wp-link-wrap:visible");return b.length?!1:!0},mediaOverlayClosed:function(){return!0},propogateModalopen:function(){this.body.trigger("axisbuilder_modal_open",this)},propogateModalContent:function(){this.body.trigger("axisbuilder_modal_finished",this)}},a.AxisBuilderModalNotification=function(b){var c={button:"close",modal_class:"flexscreen",modal_title:'<span class="axisbuilder-message-'+b.mode+'">'+axisbuilder_modal[b.mode]+"</span>",modal_content:'<div class="axisbuilder-form-element-container">'+b.message+"</div>"};return this.options=a.extend({},c,b),new a.AxisBuilderModal(this.options)},a.AxisBuilderModal.registerCallback=a.AxisBuilderModal.registerCallback||{},a.AxisBuilderModal.registerCallback.modal_load_tinymce=function(){alert("Hello TinyMCE")}}(jQuery);