!function(a){"use strict";a.AxisBuilderShortcodes=a.AxisBuilderShortcodes||{},a.AxisBuilderShortcodes.fetchShortcodeEditorElement=function(b,c,d){var e=a("#axisbuilder-tmpl-"+b);return e.length?void("instant-insert"===c&&(d.sendToBuilderCanvas(e.html()),d.updateTextarea(),d.historySnapshot(0))):void 0},a.AxisBuilderShortcodes.cloneElement=function(b,c){var d=a(b),e=d.parents(".axisbuilder-sortable-element:eq(0)"),f=!1;if(e.length||(e=d.parents(".axisbuilder-layout-column:eq(0)"),e.length||(e=d.parents(".axisbuilder-layout-section:eq(0)"))),e.is(".axisbuilder-layout-cell")){var g=e.parents(".axisbuilder-layout-row:eq(0)").find(".axisbuilder-layout-cell").length;if("undefined"==typeof a.AxisBuilderLayoutRow.newCellOrder[g])return!1;f=!0}e.find("textarea").each(function(){this.innerHTML=this.value});var h=e.clone(),i=e.parents(".axisbuilder-layout-section, .axisbuilder-layout-column");h.find(".ui-draggable, .ui-droppable").removeClass(".ui-draggable, .ui-droppable"),h.insertAfter(e),f&&a.AxisBuilderShortcodes.recalcCell(b,c),(e.is(".axisbuilder-layout-section")||e.is(".axisbuilder-layout-column")||i.length)&&i.length&&(c.updateTextarea(),c.updateInnerTextarea(e)),c.activateDragging(),c.activateDropping(),c.updateTextarea(),c.historySnapshot()},a.AxisBuilderShortcodes.trashElement=function(b,c){var d=a(b),e=d.parents(".axisbuilder-sortable-element:eq(0)"),f=!1,g=!1,h=200;if(e.length?f=d.parents(".axisbuilder-inner-shortcode:eq(0)"):(e=d.parents(".axisbuilder-layout-column:eq(0)"),f=d.parents(".axisbuilder-layout-section:eq(0)>.axisbuilder-inner-shortcode"),e.length||(e=d.parents(".axisbuilder-layout-section:eq(0)"),f=!1)),e.length&&e.is(".axisbuilder-layout-cell")){if(!(f.find(".axisbuilder-layout-cell").length>1))return!1;g=!0,h=0}e.hide(h,function(){g&&a.AxisBuilderShortcodes.removeCell(b,c),e.remove(),f&&f.length&&c.updateInnerTextarea(f),c.updateTextarea(),""===c.axisBuilderValues.val()&&c.activateDropping(c.axisBuilderParent,"destroy"),c.historySnapshot()})},a.AxisBuilderShortcodes.resizeLayout=function(b,c){for(var d=a(b),e=d.parents(".axisbuilder-layout-column:eq(0)"),f=e.parents(".axisbuilder-layout-section:eq(0)"),g=e.data("width"),h=[],i=d.is(".axisbuilder-increase")?1:-1,j=e.find(".axisbuilder-column-size"),k=e.find(".axisbuilder-inner-shortcode > "+c.shortcodesData),l=k.val(),m=[["ab_one_full","1/1"],["ab_four_fifth","4/5"],["ab_three_fourth","3/4"],["ab_two_third","2/3"],["ab_three_fifth","3/5"],["ab_one_half","1/2"],["ab_two_fifth","2/5"],["ab_one_third","1/3"],["ab_one_fourth","1/4"],["ab_one_fifth","1/5"]],n=0;n<m.length;n++)m[n][0]===g&&(h=m[n-i]);"undefined"!=typeof h&&(l=l.replace(new RegExp("^\\["+g,"g"),"["+h[0]),l=l.replace(new RegExp(g+"\\]","g"),h[0]+"]"),k.val(l),e.removeClass(g).addClass(h[0]),e.attr("data-width",h[0]).data("width",h[0]),j.text(h[1]),c.updateTextarea(),f.length&&(c.updateInnerTextarea(!1,f),c.updateTextarea()),c.historySnapshot(0))},a.AxisBuilderShortcodes.addNewCell=function(b,c){a.AxisBuilderLayoutRow.modifyCellCount(b,c,0)},a.AxisBuilderShortcodes.recalcCell=function(b,c){a.AxisBuilderLayoutRow.modifyCellCount(b,c,-1)},a.AxisBuilderShortcodes.removeCell=function(b,c){a.AxisBuilderLayoutRow.modifyCellCount(b,c,-2)},a.AxisBuilderShortcodes.setCellSize=function(b,c){a.AxisBuilderLayoutRow.setCellSize(b,c)},a.AxisBuilderLayoutRow={cellSize:[["ab_cell_one_full","1/1",1],["ab_cell_four_fifth","4/5",.8],["ab_cell_three_fourth","3/4",.75],["ab_cell_two_third","2/3",.66],["ab_cell_three_fifth","3/5",.6],["ab_cell_one_half","1/2",.5],["ab_cell_two_fifth","2/5",.4],["ab_cell_one_third","1/3",.33],["ab_cell_one_fourth","1/4",.25],["ab_cell_one_fifth","1/5",.2]],newCellOrder:[["ab_cell_one_full","1/1"],["ab_cell_one_half","1/2"],["ab_cell_one_third","1/3"],["ab_cell_one_fourth","1/4"],["ab_cell_one_fifth","1/5"]],cellSizeVariations:{4:{1:["ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_fourth"],2:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_two_fifth"],3:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_one_fifth"],4:["ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_one_fifth"],5:["ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_one_fifth"]},3:{1:["ab_cell_one_third","ab_cell_one_third","ab_cell_one_third"],2:["ab_cell_one_fourth","ab_cell_one_fourth","ab_cell_one_half"],3:["ab_cell_one_fourth","ab_cell_one_half","ab_cell_one_fourth"],4:["ab_cell_one_half","ab_cell_one_fourth","ab_cell_one_fourth"],5:["ab_cell_one_fifth","ab_cell_one_fifth","ab_cell_three_fifth"],6:["ab_cell_one_fifth","ab_cell_three_fifth","ab_cell_one_fifth"],7:["ab_cell_three_fifth","ab_cell_one_fifth","ab_cell_one_fifth"],8:["ab_cell_one_fifth","ab_cell_two_fifth","ab_cell_two_fifth"],9:["ab_cell_two_fifth","ab_cell_one_fifth","ab_cell_two_fifth"],10:["ab_cell_two_fifth","ab_cell_two_fifth","ab_cell_one_fifth"]},2:{1:["ab_cell_one_half","ab_cell_one_half"],2:["ab_cell_two_third","ab_cell_one_third"],3:["ab_cell_one_third","ab_cell_two_third"],4:["ab_cell_one_fourth","ab_cell_three_fourth"],5:["ab_cell_three_fourth","ab_cell_one_fourth"],6:["ab_cell_one_fifth","ab_cell_four_fifth"],7:["ab_cell_four_fifth","ab_cell_one_fifth"],8:["ab_cell_two_fifth","ab_cell_three_fifth"],9:["ab_cell_three_fifth","ab_cell_two_fifth"]}},modifyCellCount:function(b,c,d){var e=a(b),f=e.parents(".axisbuilder-layout-row:eq(0)"),g=f.find(".axisbuilder-layout-cell"),h=g.length+d,i=a.AxisBuilderLayoutRow.newCellOrder[h];"undefined"!=typeof i&&(h!==g.length?a.AxisBuilderLayoutRow.changeMultipleCellSize(g,i,c):(a.AxisBuilderLayoutRow.changeMultipleCellSize(g,i,c),a.AxisBuilderLayoutRow.appendCell(f,i),c.activateDropping()),c.updateInnerTextarea(!1,f),c.updateTextarea(),c.historySnapshot(0))},appendCell:function(b,c){var d=b.find("> .axisbuilder-inner-shortcode"),e=c[0].replace("ab_cell_","ab_shortcode_cells_").replace("_one_full",""),f=a(a("#axisbuilder-tmpl-"+e).html());d.append(f)},changeMultipleCellSize:function(b,c,d,e){var f="",g=c;b.each(function(b){if(e){f=c[b];for(var h in a.AxisBuilderLayoutRow.cellSize)f===a.AxisBuilderLayoutRow.cellSize[h][0]&&(g=a.AxisBuilderLayoutRow.cellSize[h])}a.AxisBuilderLayoutRow.changeSingleCellSize(a(this),g,d)})},changeSingleCellSize:function(a,b,c){var d=a.data("width"),e=a.find("> .axisbuilder-sorthandle > .axisbuilder-column-size"),f=a.find("> .axisbuilder-inner-shortcode > "+c.shortcodesData),g=f.val();g=g.replace(new RegExp("^\\["+d,"g"),"["+b[0]),g=g.replace(new RegExp(d+"\\]","g"),b[0]+"]"),f.val(g),a.removeClass(d).addClass(b[0]),a.attr("data-width",b[0]).data("width",b[0]),a.attr("data-shortcode-handler",b[0]).data("shortcode-handler",b[0]),a.attr("data-shortcode-allowed",b[0]).data("shortcode-allowed",b[0]),e.text(b[1])},setCellSize:function(b,c){var d,e,f=a(b),g=f.parents(".axisbuilder-layout-row:eq(0)"),h=g.find(".axisbuilder-layout-cell"),i=h.length,j=this.cellSizeVariations[i],k="";if(j){d="save",e="highscreen",k+="<form>";for(var l in j){var m="",n="";for(var o in j[l]){for(var p in this.cellSize)this.cellSize[p][0]===j[l][o]&&(n=this.cellSize[p][1]);m+='<span class="axisbuilder-modal-label '+j[l][o]+'">'+n+"</span>"}k+='<div class="axisbuilder-layout-row-modal"><label class="axisbuilder-layout-row-modal-label">',k+='<input type="radio" name="layout" value="'+l+'" /><span class="axisbuilder-layout-row-inner-label">'+m+"</span></label></div>"}k+="</form>"}else d="close",e="flexscreen",k+="<p>"+axisbuilder_shortcodes.i18n_no_layout+"<br />",k+=1===i?axisbuilder_shortcodes.i18n_add_one_cell:axisbuilder_shortcodes.i18n_remove_one_cell,k+="</p>";new a.AxisBuilderModalNotification({scope:this,button:d,message:k,modal_class:e,modal_title:axisbuilder_shortcodes.i18n_select_layout,on_save:this.saveModal,save_param:{obj:c,row:g,cells:h,variations:j}})},saveModal:function(b,c){var d=b&&b.layout?b.layout:!1;return d?(a.AxisBuilderLayoutRow.changeMultipleCellSize(c.cells,c.variations[d],c.obj,!0),c.obj.updateInnerTextarea(!1,c.row),c.obj.updateTextarea(),void c.obj.historySnapshot(0)):!0}}}(jQuery);