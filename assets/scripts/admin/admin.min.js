function AB_Logger(a,b){return"undefined"==typeof console?!0:("undefined"==typeof b&&(b="logger"),void(b===!1?console.log(a):(b="AB_"+b.toUpperCase(),console.log("["+b+"] - "+a))))}!function(a){"use strict";a.AxisBuilder=function(){this.wpDefaultEditorWrap=a("#postdivrich"),this.wpDefaultEditorArea=a("#content.wp-editor-area"),this.axisBuilderDebug=axisbuilder_admin.debug_mode||{},this.axisBuilderButton=a("#axisbuilder-button"),this.axisBuilderHandle=a("#axisbuilder-handle").find(".control-bar"),this.axisBuilderCanvas=a("#axisbuilder-canvas").find(".canvas-area"),this.axisBuilderValues=a("#axisbuilder-canvas").find(".canvas-data"),this.axisBuilderParent=this.axisBuilderCanvas.parents(".postbox:eq(0)"),this.axisBuilderStatus=this.axisBuilderParent.find("input[name=axisbuilder_status]"),this.tinyMceDefined="undefined"!=typeof window.tinyMCE?!0:!1,this.tinyMceVersion=this.tinyMceDefined?window.tinyMCE.majorVersion:!1,this.tinyMceContent=this.tinyMceDefined?window.tinyMCE.get("content"):!1,this.shortcodes=a.AxisBuilderShortcodes||{},this.shortcodesWrap=a(".axisbuilder-shortcodes"),this.shortcodesData='textarea[data-name="text-shortcode"]',this.targetInsert=!1,this.singleInsert=!1,this.updateTimeout=!1,this.builderActivate()},a.AxisBuilder.prototype={builderActivate:function(){this.builderPosition(),this.shortcodesToInterface(),this.builderBehaviour()},builderPosition:function(){var b=a("#normal-sortables"),c=b.find(".postbox");this.axisBuilderParent.length&&0!==c.index(this.axisBuilderParent)&&(this.axisBuilderParent.prependTo(b),window.postboxes.save_order(pagenow))},builderBehaviour:function(){var b=this,c=a("body");this.axisBuilderButton.on("click",function(a){a.preventDefault(),b.switchEditors()}),this.shortcodesWrap.on("click",".insert-shortcode",function(){var a=this.hash.replace("#",""),c="instant-insert";return b.shortcodes.fetchShortcodeEditorElement(a,c,b),!1}),this.axisBuilderHandle.on("click","a.trash-data",function(a){var c=b.axisBuilderCanvas.children().length;if(c>0){var d=window.confirm(axisbuilder_admin.i18n_delete_all_canvas_elements);d&&(d=window.confirm(axisbuilder_admin.i18n_last_warning),d&&(b.axisBuilderCanvas.empty(),b.updateTextarea()))}return a.preventDefault(),!1}),this.axisBuilderCanvas.on("click","a.axisbuilder-clone",function(){return b.shortcodes.cloneElement(this,b),!1}),this.axisBuilderCanvas.on("click","a.axisbuilder-trash",function(){return b.shortcodes.trashElement(this,b),!1}),this.axisBuilderCanvas.on("click","a.axisbuilder-change-column-size:not(.axisbuilder-change-cell-size)",function(){return b.shortcodes.resizeLayout(this,b),!1}),this.axisBuilderCanvas.on("click","a.axisbuilder-cell-set",function(){return b.shortcodes.setCellSize(this,b),!1}),this.axisBuilderCanvas.on("click","a.axisbuilder-cell-add",function(){return b.shortcodes.addNewCell(this,b),!1}),this.axisBuilderCanvas.on("axisbuilder-history-update",function(){b.activateDragging(this.axisBuilderParent,""),b.activateDropping(this.axisBuilderParent,"")}),c.on("click",".axisbuilder-edit",function(){var c=a(this).parents(".axisbuilder-sortable-element:eq(0)");c.length||(c=a(this).parents(".axisbuilder-layout-cell:eq(0)"),c.length||(c=a(this).parents(".axisbuilder-layout-section:eq(0)")));var d,e=c.data();return e.scope=b,e.modal_title=c.data("modal-title"),e.on_load=c.data("modal_on_load"),e.before_save=c.data("before_save"),e.save_param=c,e.ajax_param={extract:!0,shortcode:c.find("> .axisbuilder-inner-shortcode > "+b.shortcodesData+":eq(0)").val(),allowed:e.allowedShortcodes},d=new a.AxisBuilderModal(e),!1})},switchEditors:function(){var a=this;return"active"!==this.axisBuilderStatus.val()?(this.wpDefaultEditorWrap.parent().addClass("axisbuilder-hidden-editor"),this.axisBuilderButton.removeClass("button-primary").addClass("button-secondary").text(this.axisBuilderButton.data("default-editor")),this.axisBuilderParent.removeClass("axisbuilder-hidden"),this.axisBuilderStatus.val("active"),setTimeout(function(){a.shortcodesToInterface()},10)):(this.wpDefaultEditorWrap.parent().removeClass("axisbuilder-hidden-editor"),this.axisBuilderButton.addClass("button-primary").removeClass("button-secondary").text(this.axisBuilderButton.data("page-builder")),this.axisBuilderParent.addClass("axisbuilder-hidden"),this.axisBuilderStatus.val("inactive"),this.axisBuilderCanvas.addClass("loader").find(">*:not( .control-bar, .axisbuilder-insert-area )").remove(),"object"==typeof window.editorExpand&&window.editorExpand.off(),"disabled"!==this.axisBuilderDebug&&-1!==this.axisBuilderValues.val().indexOf("[")&&(new AB_Logger("Switching to Classic Editor. Page Builder is in Debug Mode and will empty the textarea so user can't edit shortcode directly","Editor"),this.tinyMceContent&&(this.tinyMceContent.setContent("",{format:"html"}),this.wpDefaultEditorArea.val("")))),!1},shortcodesToInterface:function(b){if("active"!==this.axisBuilderStatus.val())return!0;"undefined"==typeof b&&(b=this.axisBuilderValues.val(),-1===b.indexOf("[")&&(b=this.wpDefaultEditorArea.val(),this.tinyMceDefined&&(b=window.switchEditors._wp_Nop(b)),this.axisBuilderValues.val(b)));var c=this,d={text:b,action:"axisbuilder_shortcodes_to_interface",security:axisbuilder_admin.shortcodes_to_interface_nonce};a.ajax({url:axisbuilder_admin.ajax_url,data:d,type:"POST",success:function(a){c.sendToBuilderCanvas(a),c.axisBuilderCanvas.removeClass("loader"),c.historySnapshot()}})},sendToBuilderCanvas:function(b){var c=a(b);this.axisBuilderCanvas.append(c),this.activateDragging(),this.activateDropping()},updateInnerTextarea:function(b,c){if("undefined"==typeof c&&(c=a(b).parents(".axisbuilder-layout-section:eq(0)")),c.length||(c=a(b).parents(".axisbuilder-layout-column:eq(0)")),!c.length)return!0;var d,e,f,g,h,i,j;if(c.is(".axisbuilder-layout-section")){var k=c.find(".axisbuilder-layout-column-no-cell");for(d=0;d<k.length;d++)this.updateInnerTextarea(!1,a(k[d]));for(k=c.find(".axisbuilder-layout-cell"),d=0;d<k.length;d++)this.updateInnerTextarea(!1,a(k[d]));for(e="",i=c.data("shortcode-handler"),f=c.find(">.axisbuilder-inner-shortcode >"+this.shortcodesData),g=c.find(">.axisbuilder-inner-shortcode > div "+this.shortcodesData+":not(.axisbuilder-layout-column .axisbuilder-sortable-element "+this.shortcodesData+", .axisbuilder-layout-cell .axisbuilder-layout-column "+this.shortcodesData+")"),h=f.val().match(new RegExp("\\["+i+".*?\\]")),d=0;d<g.length;d++)e+=a(g[d]).val();e=h[0]+"\n\n"+e+"[/"+i+"]",f.val(e)}if(c.is(".axisbuilder-layout-cell")){for(e="",j=c.data("width"),f=c.find(">.axisbuilder-inner-shortcode >"+this.shortcodesData),g=c.find(">.axisbuilder-inner-shortcode > div "+this.shortcodesData+":not(.axisbuilder-layout-column-no-cell .axisbuilder-sortable-element "+this.shortcodesData+")"),h=f.val().match(new RegExp("\\["+j+".*?\\]")),d=0;d<g.length;d++)e+=a(g[d]).val();e=h[0]+"\n\n"+e+"[/"+j+"]",f.val(e)}if(c.is(".axisbuilder-layout-column:not(.axisbuilder-layout-cell)")){var l=c.is(".axisbuilder-first-column")?" first":"";for(e="",j=c.data("width"),g=c.find(".axisbuilder-sortable-element "+this.shortcodesData),f=c.find(">.axisbuilder-inner-shortcode >"+this.shortcodesData),d=0;d<g.length;d++)e+=a(g[d]).val();e="["+j+l+"]\n\n"+e+"[/"+j+"]",f.val(e)}},updateTextarea:function(b){if("active"!==this.axisBuilderStatus.val())return!0;if(!b){var c=this;this.axisBuilderCanvas.find(".axisbuilder-layout-section").each(function(){var b=a(this).find(">.axisbuilder-inner-shortcode > div > .axisbuilder-inner-shortcode"),d=a(this).find(".axisbuilder-layout-cell .axisbuilder-layout-column-no-cell > .axisbuilder-inner-shortcode");b.length&&c.updateTextarea(b),d.length&&c.updateTextarea(d)}),b=a(".axisbuilder-data > div > .axisbuilder-inner-shortcode")}for(var d,e,f,g,h="",i=0,j=b.find(">"+this.shortcodesData),k={ab_one_full:1,ab_four_fifth:.8,ab_three_fourth:.75,ab_two_third:.66,ab_three_fifth:.6,ab_one_half:.5,ab_two_fifth:.4,ab_one_third:.33,ab_one_fourth:.25,ab_one_fifth:.2},l=0;l<j.length;l++)d=a(j[l]),e=d.val(),f=d.parents(".axisbuilder-layout-column-no-cell:eq(0)"),f.length?(g=f.data("width"),i+=k[g],i>1||0===l?(f.is(".axisbuilder-first-column")||(f.addClass("axisbuilder-first-column"),e=e.replace(new RegExp("^\\["+g),"["+g+" first"),d.val(e)),i=k[g]):f.is(".axisbuilder-first-column")&&(f.removeClass("axisbuilder-first-column"),e=e.replace(" first",""),d.val(e))):i=1,h+=e;var m=this.tinyMceDefined?window.tinyMCE.get("content"):void 0;"undefined"!==m&&(clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(function(){m.setContent(window.switchEditors.wpautop(h),{format:"html"})},500)),this.wpDefaultEditorArea.val(h),this.axisBuilderValues.val(h)},historySnapshot:function(a){var b=this;a||(a=150),setTimeout(function(){b.axisBuilderCanvas.trigger("axisbuilder-storage-update")},a)},compareVersion:function(a,b){var c,d,e,f=/(\.0)+[^\.]*$/;for(a=(a+"").replace(f,"").split("."),b=(b+"").replace(f,"").split("."),e=Math.min(a.length,b.length),c=0;e>c;c++)if(d=parseInt(a[c],10)-parseInt(b[c],10),0!==d)return d;return a.length-b.length},activateDragging:function(b,c){var d=a(window),e=this.compareVersion(a.ui.draggable.version,"1.10.9")<=0?!0:!1;(-1!==navigator.userAgent.indexOf("Safari")||-1!==navigator.userAgent.indexOf("Chrome"))&&(e=!1),e&&new AB_Logger("Drag and drop Positioning fix active");var f=this,g=b||this.axisBuilderParent,h={appendTo:"body",handle:">.menu-item-handle",helper:"clone",zIndex:2e4,scroll:!0,revert:!1,cursorAt:{left:20},start:function(b){var c=a(b.target);c.css({opacity:.4}),a(".axisbuilder-hover-active").removeClass("axisbuilder-hover-active"),f.axisBuilderCanvas.addClass("axisbuilder-select-target-"+c.data("dragdrop-level"))},drag:function(a,b){e&&(b.position.top-=parseInt(d.scrollTop(),10))},stop:function(b){a(b.target).css({opacity:1}),a(".axisbuilder-hover-active").removeClass("axisbuilder-hover-active"),f.axisBuilderCanvas.removeClass("axisbuilder-select-target-1 axisbuilder-select-target-2 axisbuilder-select-target-3 axisbuilder-select-target-4")}};"undefined"==typeof c&&(c=":not(.ui-draggable)"),g.find(".axisbuilder-drag"+c).draggable(h),h.cursorAt={left:33,top:33},h.handle=!1,g.find(".insert-shortcode").not(".ui-draggable").draggable(h)},activateDropping:function(b,c){var d=this,e=b||this.axisBuilderParent,f={greedy:!0,tolerance:"pointer",over:function(b,c){var e=a(this);d.isDropingAllowed(c.helper,e)&&e.addClass("axisbuilder-hover-active")},out:function(){a(this).removeClass("axisbuilder-hover-active")},drop:function(b,c){var e=a(this);if(!e.is(".axisbuilder-hover-active"))return!1;var f,g,h,i=e.find(">.axisbuilder-drag"),j={},k={},l="after",m=!1,n=[];for(h=0;h<i.length;h++){var o=i.eq(h);if(k=o.offset(),!(k.top<c.offset.top))break;m=o,f=k,n["top_"+k.top]||(g=0,n["top_"+k.top]=[]);var p=o.outerHeight()+k.top;g=g>p?g:p,n["top_"+k.top].push({index:h,top:k.top,left:k.left,height:o.outerHeight(),maxheight:o.outerHeight()+k.top})}if(f&&n["top_"+f.top].length>1&&g-40>c.offset.top){var q=!1;for(h=0;h<n["top_"+f.top].length&&n["top_"+f.top][h].left<c.offset.left;h++)q=n["top_"+f.top][h].index;q===!1&&(q=n["top_"+f.top][0].index,l="before"),m=i.eq(q)}if(m===!1&&(m=e,l="prepend"),m[0]===c.draggable[0])return!0;if(c.draggable[0].hash){var r=c.draggable.get(0).hash.replace("#","");j=a(a("#axisbuilder-tmpl-"+r).html()),c.draggable=j}var s=c.draggable.parents(".axisbuilder-drag:last");m[l](c.draggable),s.length&&d.updateInnerTextarea(!1,s);var t="after"===l?m.parents(".axisbuilder-drop"):m;0!==t.data("dragdrop-level")&&(d.updateTextarea(),d.updateInnerTextarea(c.draggable)),d.updateTextarea(),"undefined"!=typeof j&&(d.axisBuilderCanvas.removeClass("ui-droppable").droppable("destroy"),d.activateDragging(),d.activateDropping()),d.historySnapshot()}};"undefined"==typeof c&&(c=":not(.ui-droppable)"),"destroy"===c&&(e.find(".axisbuilder-drop").droppable("destroy"),c=""),e.find(".axisbuilder-drop"+c).droppable(f)},isDropingAllowed:function(a,b){return a.data("dragdrop-level")>b.data("dragdrop-level")?!0:!1}},a(document).ready(function(){a.AxisBuilderObj=new a.AxisBuilder})}(jQuery);